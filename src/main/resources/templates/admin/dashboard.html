<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - BudgetMap</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>

<body class="admin-body">

<!-- HEADER -->
<div th:replace="~{layouts/header :: header}"></div>

<div class="admin-container">
    
    <!-- HEADER DEL DASHBOARD -->
    <div class="admin-welcome-card fade-in">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="admin-title mb-2">
                    <i class="bi bi-speedometer2"></i>
                    Panel de Administración
                </h1>
                <p class="admin-subtitle mb-0">
                    <i class="bi bi-calendar-check me-2"></i>
                    Bienvenido, <span sec:authentication="name" class="fw-bold">Admin</span>
                    <span class="ms-3">
                        <i class="bi bi-clock me-1"></i>
                        <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span>
                    </span>
                </p>
            </div>
            <div class="col-md-4 text-end">
                <a th:href="@{/logout}" class="btn btn-outline-danger">
                    <i class="bi bi-box-arrow-right me-2"></i>
                    Cerrar Sesión
                </a>
            </div>
        </div>
    </div>

    <!-- SECCIÓN: USUARIOS -->
    <div class="admin-section fade-in">
        <div class="section-header">
            <h3 class="section-title">
                <i class="bi bi-people-fill me-2"></i>
                Gestión de Usuarios
            </h3>
            <a th:href="@{/admin/usuarios}" class="btn btn-light btn-sm">
                <i class="bi bi-arrow-right-circle me-1"></i>
                Ver todos
            </a>
        </div>

        <div class="row g-4">
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-warning">
                    <div class="stat-icon">
                        <i class="bi bi-hourglass-split"></i>
                    </div>
                    <div class="stat-number" th:text="${usuariosPendientes}">0</div>
                    <div class="stat-label">Usuarios Pendientes</div>
                    <div class="stat-action">
                        <a th:href="@{/admin/usuarios(estado='PENDIENTE')}" 
                           class="btn btn-sm btn-warning">
                            <i class="bi bi-eye me-1"></i> Revisar
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="bi bi-check-circle-fill"></i>
                    </div>
                    <div class="stat-number" th:text="${usuariosActivos}">0</div>
                    <div class="stat-label">Usuarios Activos</div>
                    <div class="stat-action">
                        <span class="badge bg-success">
                            <i class="bi bi-graph-up-arrow me-1"></i>
                            +12% este mes
                        </span>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-danger">
                    <div class="stat-icon">
                        <i class="bi bi-x-circle-fill"></i>
                    </div>
                    <div class="stat-number" th:text="${usuariosRechazados}">0</div>
                    <div class="stat-label">Usuarios Rechazados</div>
                    <div class="stat-action">
                        <a th:href="@{/admin/usuarios(estado='RECHAZADO')}" 
                           class="btn btn-sm btn-outline-danger">
                            <i class="bi bi-list me-1"></i> Ver lista
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-primary">
                    <div class="stat-icon">
                        <i class="bi bi-person-plus-fill"></i>
                    </div>
                    <div class="stat-number" 
                         th:text="${usuariosPendientes + usuariosActivos + usuariosRechazados}">0</div>
                    <div class="stat-label">Total Usuarios</div>
                    <div class="stat-action">
                        <a th:href="@{/admin/usuarios/crear}" 
                           class="btn btn-sm btn-primary">
                            <i class="bi bi-plus-lg me-1"></i> Crear nuevo
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN: ESTABLECIMIENTOS -->
    <div class="admin-section fade-in">
        <div class="section-header">
            <h3 class="section-title">
                <i class="bi bi-shop-window me-2"></i>
                Establecimientos
            </h3>
            <a th:href="@{/admin/establecimientos}" class="btn btn-light btn-sm">
                <i class="bi bi-arrow-right-circle me-1"></i>
                Ver todos
            </a>
        </div>

        <div class="row g-4">
            <div class="col-xl-4 col-md-6">
                <div class="stat-card stat-warning">
                    <div class="stat-icon">
                        <i class="bi bi-clock-history"></i>
                    </div>
                    <div class="stat-number" th:text="${establecimientosPendientes}">0</div>
                    <div class="stat-label">Pendientes de Aprobación</div>
                    <div class="stat-action">
                        <a th:href="@{/admin/establecimientos(estado='PENDIENTE')}" 
                           class="btn btn-sm btn-warning">
                            <i class="bi bi-check2-square me-1"></i> Aprobar
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-xl-4 col-md-6">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="bi bi-shield-check"></i>
                    </div>
                    <div class="stat-number" th:text="${establecimientosAprobados}">0</div>
                    <div class="stat-label">Establecimientos Aprobados</div>
                </div>
            </div>

            <div class="col-xl-4 col-md-6">
                <div class="stat-card stat-danger">
                    <div class="stat-icon">
                        <i class="bi bi-slash-circle"></i>
                    </div>
                    <div class="stat-number" th:text="${establecimientosRechazados}">0</div>
                    <div class="stat-label">Establecimientos Rechazados</div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN: LUGARES -->
    <div class="admin-section fade-in">
        <div class="section-header">
            <h3 class="section-title">
                <i class="bi bi-geo-alt-fill me-2"></i>
                Lugares
            </h3>
            <a th:href="@{/admin/lugares}" class="btn btn-light btn-sm">
                <i class="bi bi-arrow-right-circle me-1"></i>
                Ver todos
            </a>
        </div>

        <div class="row g-4">
            <div class="col-xl-6 col-md-6">
                <div class="stat-card stat-info">
                    <div class="stat-icon">
                        <i class="bi bi-file-earmark-text"></i>
                    </div>
                    <div class="stat-number" th:text="${lugaresBorradores}">0</div>
                    <div class="stat-label">Lugares en Borrador</div>
                    <div class="stat-action">
                        <a th:href="@{/admin/lugares(estado='BORRADOR')}" 
                           class="btn btn-sm btn-info">
                            <i class="bi bi-pencil me-1"></i> Editar
                        </a>
                    </div>
                </div>
            </div>

            <div class="col-xl-6 col-md-6">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="bi bi-globe"></i>
                    </div>
                    <div class="stat-number" th:text="${lugaresPublicados}">0</div>
                    <div class="stat-label">Lugares Publicados</div>
                    <div class="stat-action">
                        <a th:href="@{/admin/lugares/crear}" 
                           class="btn btn-sm btn-success">
                            <i class="bi bi-plus-lg me-1"></i> Crear lugar
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SECCIÓN: EVENTOS -->
    <div class="admin-section fade-in">
        <div class="section-header">
            <h3 class="section-title">
                <i class="bi bi-calendar-event me-2"></i>
                Eventos
            </h3>
            <a th:href="@{/admin/eventos}" class="btn btn-light btn-sm">
                <i class="bi bi-arrow-right-circle me-1"></i>
                Ver todos
            </a>
        </div>

        <div class="row g-4">
            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-warning">
                    <div class="stat-icon">
                        <i class="bi bi-hourglass"></i>
                    </div>
                    <div class="stat-number" th:text="${eventosPendientes}">0</div>
                    <div class="stat-label">Pendientes</div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-success">
                    <div class="stat-icon">
                        <i class="bi bi-play-circle"></i>
                    </div>
                    <div class="stat-number" th:text="${eventosActivos}">0</div>
                    <div class="stat-label">Activos</div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-danger">
                    <div class="stat-icon">
                        <i class="bi bi-x-octagon"></i>
                    </div>
                    <div class="stat-number" th:text="${eventosRechazados}">0</div>
                    <div class="stat-label">Rechazados</div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6">
                <div class="stat-card stat-indigo">
                    <div class="stat-icon">
                        <i class="bi bi-check2-all"></i>
                    </div>
                    <div class="stat-number" th:text="${eventosFinalizados}">0</div>
                    <div class="stat-label">Finalizados</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ACCIONES RÁPIDAS -->
    <div class="admin-section fade-in">
        <h3 class="section-title">
            <i class="bi bi-lightning-charge-fill me-2"></i>
            Acciones Rápidas
        </h3>

        <div class="row g-4">
            <div class="col-lg-3 col-md-6">
                <a th:href="@{/admin/usuarios/crear}" class="action-card action-primary">
                    <div class="action-icon">
                        <i class="bi bi-person-plus"></i>
                    </div>
                    <h5>Crear Usuario</h5>
                    <p>Agregar nuevo usuario al sistema</p>
                </a>
            </div>

            <div class="col-lg-3 col-md-6">
                <a th:href="@{/admin/lugares/crear}" class="action-card action-info">
                    <div class="action-icon">
                        <i class="bi bi-pin-map"></i>
                    </div>
                    <h5>Crear Lugar</h5>
                    <p>Registrar un nuevo lugar</p>
                </a>
            </div>

            <div class="col-lg-3 col-md-6">
                <a th:href="@{/admin/establecimientos}" class="action-card action-warning">
                    <div class="action-icon">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <h5>Aprobar</h5>
                    <p>Revisar solicitudes pendientes</p>
                </a>
            </div>

            <div class="col-lg-3 col-md-6">
                <a th:href="@{/admin/usuarios/exportar-pdf}" class="action-card action-danger">
                    <div class="action-icon">
                        <i class="bi bi-file-pdf"></i>
                    </div>
                    <h5>Exportar</h5>
                    <p>Generar reportes en PDF</p>
                </a>
            </div>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Animación de contadores
    document.querySelectorAll('.stat-number').forEach(counter => {
        const target = parseInt(counter.textContent);
        if (isNaN(target)) return;
        
        let current = 0;
        const increment = target / 50;
        const timer = setInterval(() => {
            current += increment;
            if (current >= target) {
                counter.textContent = target;
                clearInterval(timer);
            } else {
                counter.textContent = Math.floor(current);
            }
        }, 20);
    });
</script>

</body>
</html>S